<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>Indigenous Territories of the Pacific Salmon Commission Panels</title>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
    <script src='https://api.mapbox.com/mapbox-gl-js/v1.12.0/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v1.12.0/mapbox-gl.css' rel='stylesheet' />
    <script src="https://unpkg.com/papaparse@latest/papaparse.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
        }

        #map {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 100%;
        }

        .mapboxgl-popup {
            max-width: 400px;
            font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;
        }

        .mapboxgl-popup {
            max-width: 400px;
            font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;
        }
        #position { 
            position:absolute; top:0; height: 95.5%; width: 320px; 
            background-color: #154360;
            padding: 15px;
            margin: 0px;
            font: 16px/26px 'Calibri', Arial, Helvetica, sans-serif;
            color: white
        }
    </style>
</head>

<body>
    <div id="map"></div>
    <div id="position">
        <h2 style = "color:#A4CCE5">Indigenous Territories of the Pacific Salmon Commission Panels <br></h2>
        <hr size = "2" noshade color="#A4CCE5">
        <body> <br> Salmon is at the heart of the culture and wellbeing of Tribes and First Nations of the Pacific Northwest. With
            salmon populations in decline across the region, it is important to broaden understanding of the breadth and
            depth of sociocultural values associated with salmon, particularly as those values relate to the well-being of
            Indigenous Peoples, Tribes and First Nations. <br> </body>
        <h4><br>Hover over the map to see which Indigenous Territories are located there. <br></h4>
        <body> <i>SOURCE: <a href = "https://native-land.ca" style = "color:#A4CCE5">native-land.ca</a></i></body>
    </div>
    <script>
        //YOUR TURN: Replace with your Mapbox Token
        mapboxgl.accessToken = 'pk.eyJ1IjoiYWxpbjcxMzgiLCJhIjoiY2s5bHhzM2p5MDNuajNrbnFxZW5yd3RmZyJ9.bnOBSehlyZ1_URBS8zlKEg';
        var map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/alin7138/ckiurbisu35ks19nuzht54lsn', //style url 
            zoom: 3.2,
            center: [-142, 58]
        });

        map.on('load', function () {
            //YOUR TURN: Replace with a link to your CSV
            const csvUrl = 'https://raw.githubusercontent.com/alin7138/ee_psc_map/main/IndigenousTerritories_PanelsOnly.csv';
            Papa.parse(csvUrl, {
                download: true,
                header: true,
                skipEmptyLines: true,
                complete: function (results) {
                    map.once('idle', () => {
                        console.log(results.data);
                        results.data.forEach(row => {
                            map.setFeatureState({
                                //YOUR TURN: Replace with your source tileset and source layer
                                source: '<IndigenousTerritories_PanelsO-2mhybg>',
                                sourceLayer: '<IndigenousTerritories_PanelsO-2mhybg>',
                                //YOUR TURN: Replace with unqiue ID row name
                                id: row.Name
                            },
                                //YOUR TURN: Add rows you want to style/interact with
                                {
                                    name: row.Name
                                });
                        });

                        //YOUR TURN: Add layers to the map  
                        map.addLayer({
                            'id': 'IndigenousTerritories_PanelsO-2mhybg-fill',
                            'type': 'fill',
                            'source': 'IndigenousTerritories_PanelsO-2mhybg',
                            'source-layer': 'IndigenousTerritories_PanelsO-2mhybg',
                            'layout': {},
                            'paint': {
                                'fill-color': "#FFC500",
                                'fill-opacity': 0.1

                            }

    });
                          
                    })
                }
            });
            //YOUR TURN: Add source layer
            map.addSource('IndigenousTerritories_PanelsO-2mhybg', {
                type: 'vector',
                url: 'mapbox://alin7138.31c9kemx',
                promoteId: 'OBJECTID'
            });
        });

        var popup = new mapboxgl.Popup({
            closeButton: false,
            closeOnClick: true
        });

        map.on('mousemove', 'IndigenousTerritories_PanelsO-2mhybg-fill', function (e) {

            map.getCanvas().style.cursor = 'pointer';

            var district = map.queryRenderedFeatures(e.point, { layers: ['IndigenousTerritories_PanelsO-2mhybg-fill'] });
            var list_of_territories = district.length;
            var i;
            var content = '<b>' + 'Territories:' + '</b>' + '<br>';
            for (i = 0; i < district.length; i++) {
                var props = district[i].properties;           
                content += props.Name + '<br>';
            }
            popup.setLngLat(e.lngLat).setHTML(content).addTo(map);
 
        });

        map.on('mouseleave', 'county-fill', function () {
            map.getCanvas().style.cursor = '';
            popup.remove()


        });


    </script>

</body>

</html>